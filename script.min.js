var canvas=document.getElementById("maincanvas"),ctx=canvas.getContext("2d"),helium_button=document.getElementById("helium"),mercure_button=document.getElementById("mercure"),hydrogene_button=document.getElementById("hydrogene"),angle_of_view=47,old_angle_of_view=angle_of_view,viewpoint_width=2,viewpoint_width_x=500,isDrawing=!1,x=0,y=0,wavelengths_helium=[[402.6,.2],[412.1,.1],[438.8,.3],[443.7,.2],[447.1,.8],[471.3,.6],[492.2,.6],[501.6,.8],[504.8,.3],[587.6,1.2],[667.8,.8],[706.5,.2]],wavelengths_mercure=
[[404.7,1],[407.8,.5],[435.8,1],[491.6,.5],[546.1,1],[577,1.4],[579,1.7]],wavelengths_hydrogene=[[410.2,.1],[434,.3],[486.1,.5],[656.3,1.3]],form=document.querySelector("form");form[0].checked?current_wavelengths=wavelengths_helium:form[1].checked?current_wavelengths=wavelengths_mercure:form[2].checked&&(current_wavelengths=wavelengths_hydrogene);
form.addEventListener("change",function(a){"helium"==a.target.attributes.value.value?current_wavelengths=wavelengths_helium:"mercure"==a.target.attributes.value.value?current_wavelengths=wavelengths_mercure:"hydrogene"==a.target.attributes.value.value&&(current_wavelengths=wavelengths_hydrogene)});function draw_lines(){current_wavelengths.forEach(draw_line)}
function draw_line(a,b){wavelength=a[0];strength=a[1];angle=angle_from_wavelength(wavelength);if(!(Math.abs(angle-angle_of_view)>viewpoint_width/2)){ctx.lineWidth=1+2*strength;var c=angle_to_x(angle);ctx.strokeStyle=nmToRGB(wavelength,strength);ctx.beginPath();ctx.moveTo(c,125);ctx.lineTo(c,45);ctx.closePath();ctx.stroke()}}function angle_from_wavelength(a){return 2.47557003257329-.016286644951140065*Math.sqrt(-115660+307*a)+50}
function angle_to_x(a){return viewpoint_width_x/2+viewpoint_width_x/2*Math.tan((a-angle_of_view)*Math.PI/180)/Math.tan(viewpoint_width/2*Math.PI/180)}canvas.addEventListener("mousedown",function(a){x=a.offsetX;y=a.offsetY;isDrawing=!0;old_angle_of_view=angle_of_view});canvas.addEventListener("mousemove",function(a){!0===isDrawing&&(angle_of_view=old_angle_of_view-.01*(a.offsetX-x)*(.2+a.offsetY/50))});canvas.addEventListener("mouseup",function(a){!0===isDrawing&&(isDrawing=!1)});
var nonius_pixel_width=600,bottom_nonius_angle_width=45,bottom_nonius_shift=15,top_nonius_ticks=30,top_nonius_width=14.5,one_degree_bottom=nonius_pixel_width/bottom_nonius_angle_width,one_minute_top=one_degree_bottom*top_nonius_width/top_nonius_ticks,position_zero_x=450,position_zero_y=300,basic_tick_length=20;
function draw_top_nonius(){ctx.lineWidth=1;ctx.strokeStyle="rgb(230, 200, 200)";ctx.font="20px Arial";ctx.beginPath();for(var a=0;a<=top_nonius_ticks;a++)0==a%5?0==a%10?(ctx.strokeText(a,position_zero_x-(a+4)*one_minute_top,position_zero_y-1.8*basic_tick_length),ctx.moveTo(position_zero_x-a*one_minute_top,position_zero_y),ctx.lineTo(position_zero_x-a*one_minute_top,position_zero_y-1.5*basic_tick_length)):(ctx.moveTo(position_zero_x-a*one_minute_top,position_zero_y),ctx.lineTo(position_zero_x-a*one_minute_top,
position_zero_y-1.2*basic_tick_length)):(ctx.moveTo(position_zero_x-a*one_minute_top,position_zero_y),ctx.lineTo(position_zero_x-a*one_minute_top,position_zero_y-basic_tick_length));ctx.closePath();ctx.stroke()}
function draw_bottom_nonius(){ctx.lineWidth=1;ctx.strokeStyle="rgb(230, 200, 200)";ctx.font="20px Arial";ctx.beginPath();for(var a=Math.floor(2*angle_of_view)-2*bottom_nonius_shift,b=a;b<=a+2*bottom_nonius_angle_width;b++)xpos=position_zero_x-one_degree_bottom*(b-2*angle_of_view)/2,0==b%2?0==b%10?(0==b%20&&ctx.strokeText(b/2,xpos-10,position_zero_y+2.3*basic_tick_length),ctx.moveTo(xpos,position_zero_y),ctx.lineTo(xpos,position_zero_y+1.5*basic_tick_length)):(ctx.moveTo(xpos,position_zero_y),ctx.lineTo(xpos,
position_zero_y+1.2*basic_tick_length)):(ctx.moveTo(xpos,position_zero_y),ctx.lineTo(xpos,position_zero_y+basic_tick_length));ctx.closePath();ctx.stroke()}
function draw(){requestAnimationFrame(draw);ctx.clearRect(0,0,canvas.width,canvas.height);draw_lines();ctx.strokeStyle="rgba(250, 250, 250, 0.8)";ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(viewpoint_width_x/2,130);ctx.lineTo(viewpoint_width_x/2,40);ctx.moveTo(viewpoint_width_x/2-45,85);ctx.lineTo(viewpoint_width_x/2+45,85);ctx.closePath();ctx.stroke();draw_top_nonius();draw_bottom_nonius()}draw();
